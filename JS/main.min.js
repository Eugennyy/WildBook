"use strict";null!=localStorage.getItem("WildBook's books")&&null!=localStorage.getItem("WildBook's cart")&&null!=localStorage.getItem("WildBook's profiles")||(localStorage.setItem("WildBook's books",JSON.stringify(booksData)),localStorage.setItem("WildBook's cart",JSON.stringify(cartData)),localStorage.setItem("WildBook's profiles",JSON.stringify(profilesData))),function(){let e=document.querySelectorAll('a[href^="#"]');for(let t of e)t.addEventListener("click",function(e){e.preventDefault();let o=t.getAttribute("href");document.querySelector(o).scrollIntoView({block:"center",behavior:"smooth"})})}();let $buttonUp=$(".buttonUp");function parseJSON(){return JSON.parse(localStorage.getItem("WildBook's books"))}function parseProfilesData(){return JSON.parse(localStorage.getItem("WildBook's profiles"))}function parseCartData(){return JSON.parse(localStorage.getItem("WildBook's cart"))}$buttonUp.hide(),$buttonUp.on("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),function e(){window.addEventListener("scroll",e),$(document).scrollTop()>$(window).height()?$buttonUp.fadeIn(400):$buttonUp.fadeOut(400)}(),$(".slider").slick({arrows:!1,dots:!0,slidesToShow:1,slidesToScroll:1,fade:!0,speed:1e3,autoplay:!0,autoplaySpeed:1e4,responsive:[{breakpoint:1025,settings:{dots:!1}}]});let cartActive,isActive,buttonEntrance=document.querySelector(".modalEntrance__button"),buttonBlock=document.querySelector(".menu__item_profileBlock"),profilePhoto=document.querySelector(".modalProfile__photo"),profileEmail=document.querySelector("#profileEmail"),profileLogin=document.querySelector("#profileLogin"),profilePassword=document.querySelector("#profilePassword"),cart=document.querySelector("#cart"),cartItems=parseCartData(),cartButton=document.querySelector("#cartButton"),profiles=parseProfilesData();function profileEntrance(){let e=document.querySelector("#accountLogin"),t=document.querySelector("#accountPassword"),o=document.querySelector('[data-fancybox="modalAccount"]'),r=e.value,n=t.value;profiles.forEach(e=>{if(r===e.login&&n===e.password){isActive=!0,cartActive=!0,e.active=!0,localStorage.setItem("WildBook's profiles",JSON.stringify(profiles)),$.fancybox.close(),o.remove();let t=document.createElement("a");t.classList.add("menu__link","menu__link_style"),t.innerText=e.login,t.setAttribute("data-fancybox","modalProfile"),t.setAttribute("data-src","#modalProfile"),t.style.cursor="pointer",buttonBlock.prepend(t),profilePhoto.setAttribute("src",`${e.photo}`),profileEmail.value=e.email,profileLogin.value=e.login,profilePassword.value=e.password,checkCart()}})}buttonEntrance.addEventListener("click",function(e){e.preventDefault(),profileEntrance()});let photoChanged,profileIndex,buttonProfileEdit=document.querySelector(".modalProfile__edit");buttonProfileEdit.addEventListener("click",function(e){e.preventDefault();let t,o={email:profileEmail.value,login:profileLogin.value,password:profilePassword.value,photo:profilePhoto.src,active:!0};profiles.forEach(e=>{if(profileIndex=profiles.indexOf(e),(o.email!==e.email||o.login!==e.login||o.password!==e.password||!0===photoChanged)&&!0===(t=confirm("Применить внесенные изменения?")))if(photoChanged=!1,!0===e.admin){let e={email:profileEmail.value,login:profileLogin.value,password:profilePassword.value,photo:profilePhoto.src,admin:!0,active:!0};profiles[profileIndex]=e,localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))}else profiles[profileIndex]=o,localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))})});let buttonExit=document.querySelector(".modalProfile__exit");function changeProfileButton(){let e=document.querySelector(".menu__link_style"),t=document.createElement("a");$.fancybox.close(),e.remove(),t.classList.add("menu__link","menu__link_style"),t.innerText="Личный кабинет",t.setAttribute("data-fancybox","modalAccount"),t.setAttribute("data-src","#modalAccount"),t.style.cursor="pointer",buttonBlock.prepend(t)}buttonExit.addEventListener("click",function(e){e.preventDefault(),!0===confirm("Вы уверены, что хотите выйти?")&&(cartActive=!1,isActive=!1,profiles.forEach(e=>{e.active=!1}),localStorage.setItem("WildBook's profiles",JSON.stringify(profiles)),changeProfileButton(),checkCart())});let email=document.querySelector("#regEmail"),login=document.querySelector("#regLogin"),password=document.querySelector("#regPassword"),photo=document.querySelector(".modalReg__photo"),inputPhoto=document.querySelector(".modalReg__setPhoto");function profileRegistration(){let e=document.querySelector(".modalReg__button");e.addEventListener("click",()=>{if(""===email.value||""===login.value||""===password.value)e.removeAttribute("data-fancybox");else{e.setAttribute("data-fancybox","modalSuccessfulReg");let t={email:email.value,login:login.value,password:password.value,photo:photo.src};profiles.push(t),localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))}})}function chooseFileProfile(e){let t=e.target,o=new FileReader;o.onload=function(){let e=o.result;document.querySelector(".modalProfile__photo").src=e},o.readAsDataURL(t.files[0]),photoChanged=!0}function chooseFile(e){let t=e.target,o=new FileReader;o.onload=function(){let e=o.result;document.querySelector(".modalReg__photo").src=e},o.readAsDataURL(t.files[0])}profileRegistration();let buttonRegExit=document.querySelector(".modalSuccessReg__button");function checkCart(){!0===cartActive?cart.classList.remove("menu__icon_style"):cart.classList.add("menu__icon_style")}function createNewBooks(e="./img/books/Books-error.png",t="Название книги не найдено."){return`<img src="${e}" alt="New book" class="section4__img">\n            <div class="section4__text">\n                <h4 class="section4__h4" data-book="book">${t}</h4>\n            </div>`}function createInfoNewBooks(e=`${Math.random()}`,t="./img/books/Books-error.png",o="Название книги не найдено.",r="Издательство книги не найдено.",n="Жанр книги не найден.",a="Автор книги не найден",i="Год выпуска книги не найден",l="Описание книги не найдено",s="Цена книги не найдена."){return`<div class="section4__info" data-id="${e}">\n                <div class="section4__pic">\n                    <img src="${t}" alt="New book" class="section4__picture">\n                </div>\n                <div class="section4__information">\n                    <h3 class="section4__h3 section4__h3_style">${o}</h3>\n                    <h3 class="section4__h3"><span class="section4__inline">Издательство:</span> ${r}</h3>\n                    <h3 class="section4__h3"><span class="section4__inline">Жанр:</span> ${n}</h3>\n                    <span class="section4__author"><span class="section4__inline">Автор:</span> ${a}</span>\n                    <span class="section4__author"><span class="section4__inline">Год издания:</span> ${i}</span>\n                    <p class="section4__desc">${l}</p>\n                    <span class="section4__author"><span class="section4__inline">Цена:</span> ${s}₴</span>\n                    <div class="section4__control">\n                        <span class="section4__amount">Количество: </span>\n                        <button type="button" class="section4__btnMinus">-</button>\n                        <div class="section4__inputBlock">\n                            <input type="number" class="section4__count" min="1" max="20" value="1" data-oldprice="${s}"></input>\n                        </div>\n                        <button type="button" class="section4__btnPlus">+</button>\n                    </div>\n                    <div class="section4__btnBuy">\n                        <div class="section4__hint">Вы не зарегистрированы.</div>\n                    </div>\n                </div>\n            </div>`}function renderNewBooks(){parseJSON().forEach(e=>{if(!0===e.New){let t=document.querySelector(".section4__slider"),o=document.createElement("div"),r=document.createElement("div");o.classList.add("section4__slider-item"),r.classList.add("section4__stars"),o.setAttribute("data-book","viewBook"),o.dataset.id=e.id,o.innerHTML=createNewBooks(e.imageUrl,e.name,e.price,e.stars),t.append(o);let n=document.querySelectorAll(".section4__text");for(let t=0;t<e.rating;t++){let e=document.createElement("div");e.classList.add("section4__star"),e.innerText="★",r.append(e)}for(let t=e.rating;t<5;t++){let e=document.createElement("div");e.classList.add("section4__star","section4__star_style"),e.innerText="★",r.append(e)}n.forEach(e=>{e.append(r)})}})}function renderInfoNewBooks(e,t,o,r,n,a,i,l,s){document.querySelector(".section4__submain").innerHTML=createInfoNewBooks(e,t,o,r,n,a,i,l,s);let c=document.querySelector(".section4__count"),d=document.querySelector(".section4__control"),u=document.createElement("button"),m=document.querySelector(".section4__btnBuy");if(u.classList.add("section4__buttonBuy"),u.innerText="В корзину",m.prepend(u),!0===isActive){d.classList.remove("section4__control_style"),u.classList.remove("section4__buttonBuy_style"),u.removeAttribute("disabled");let r=document.querySelector("#cartCount"),n=+cart.innerText,a=document.querySelector(".section4__btnMinus"),i=document.querySelector(".section4__btnPlus"),l=s,m={orderId:e,orderPrice:s,orderAmount:+c.value};a.addEventListener("click",function(){c.value>1&&(c.value--,function(){let t=+c.dataset.oldprice;l-=t,c.dataset.increasedprice=l,m={orderId:e,orderPrice:l,orderAmount:+c.value}}())}),i.addEventListener("click",function(){c.value<20&&(c.value++,function(){let t=+c.dataset.oldprice;l+=t,c.dataset.increasedprice=l,m={orderId:e,orderPrice:l,orderAmount:+c.value}}())}),u.addEventListener("click",function(a){a.preventDefault(),alert("Книга успешно добавлена в корзину.");let i=document.createElement("div"),s=document.querySelector(".modalCart__buyBlock");i.classList.add("modalCart__item"),i.dataset.id=e,i.dataset.price=l,i.dataset.amount=+c.value,s.style.display="flex",cartItems.push(m),n=cartItems.length,r.innerText=n,localStorage.setItem("WildBook's cart",JSON.stringify(cartItems)),i.innerHTML=createCartItem(t,o,m.orderPrice,m.orderAmount),cartItemsBlock.append(i);let d=document.querySelector("#finalPrice"),u=document.querySelectorAll(".modalCart__price"),p=0,_=e=>{d.textContent=`${e}₴`};function f(){$(this).closest($(".modalCart__item")).remove(),function(e){let t=0;e.forEach(e=>t+=parseInt(e.textContent)),_(t)}(u=document.querySelectorAll(".modalCart__price")),function(e){let t;cartItems=[],e.each(function(){t={orderId:+$(this).attr("data-id"),orderPrice:+$(this).attr("data-price"),orderAmount:+$(this).attr("data-amount")},cartItems.push(t)}),localStorage.setItem("WildBook's cart",JSON.stringify(cartItems)),0===cartItems.length&&(s.style.display="none")}($(".modalCart__item")),n=cartItems.length,r.innerText=n}u.forEach(e=>p+=parseInt(e.textContent)),_(p),$(".modalCart__delete").each(function(){$(this).on("click",f)})})}else d.classList.add("section4__control_style"),u.classList.add("section4__buttonBuy_style"),u.setAttribute("disabled","disabled")}function returnBook(e){let t;return parseJSON().forEach(o=>{+e==+o.id&&(t=o)}),t}buttonRegExit.addEventListener("click",()=>{document.querySelectorAll(".modal").forEach(e=>{$.fancybox.close()}),email.value="",login.value="",password.value="",photo.src="./img/ProfilesPhotos/no-photo.jpg"}),renderNewBooks(),$(".section4__slider").slick({arrows:!1,dots:!0,slidesToShow:5,slidesToScroll:5,speed:700,infinite:!1,responsive:[{breakpoint:940,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:805,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:580,settings:{slidesToShow:2,slidesToScroll:2,infinite:!0}},{breakpoint:421,settings:{slidesToShow:1,slidesToScroll:1,infinite:!0,speed:650}}]});let sliderItems=document.querySelectorAll(".section4__slider-item");function bookClick(){sliderItems.forEach(e=>{e.addEventListener("click",()=>{let t=returnBook(e.dataset.id);history.pushState(null,null,`?id=${t.id}#view`),renderInfoNewBooks(t.id,t.imageUrl,t.name,t.publishingHouse,t.genre,t.author,t.year,t.description,t.price)})})}!function(){let e=[];parseJSON().forEach(t=>{!0===t.New&&e.push(t.id)}),renderInfoNewBooks(returnBook(e[0]).id,returnBook(e[0]).imageUrl,returnBook(e[0]).name,returnBook(e[0]).publishingHouse,returnBook(e[0]).genre,returnBook(e[0]).author,returnBook(e[0]).year,returnBook(e[0]).description,returnBook(e[0]).price)}(),bookClick(),function(){let e=location.hash.slice(1),t=location.search.slice(4);""===e&&""===t||"view"===e&&(renderInfoNewBooks(returnBook(t).id,returnBook(t).imageUrl,returnBook(t).name,returnBook(t).publishingHouse,returnBook(t).genre,returnBook(t).author,returnBook(t).year,returnBook(t).description,returnBook(t).price),$("html").animate({scrollTop:$("#newBooks").offset().top},650))}(),$(document).ready(function(){let e=document.querySelector(".menu__link_style");profiles.forEach(t=>{if(t.active){isActive=!0,cartActive=!0,$.fancybox.close(),e.remove();let o=document.createElement("a");o.classList.add("menu__link","menu__link_style"),o.innerText=t.login,o.setAttribute("data-fancybox","modalProfile"),o.setAttribute("data-src","#modalProfile"),o.style.cursor="pointer",buttonBlock.prepend(o),profilePhoto.setAttribute("src",`${t.photo}`),profileEmail.value=t.email,profileLogin.value=t.login,profilePassword.value=t.password,checkCart()}})});let modalCart=document.querySelector("#modalCart"),cartImage=document.querySelector(".modalCart__image"),cartItemsBlock=document.querySelector(".modalCart__items");function createCartItem(e,t,o,r){return`<div class="modalCart__remove">\n                <i class="far fa-trash-alt modalCart__delete"></i>\n            </div>\n            <img src="${e}" alt="${t}" class="modalCart__image">\n            <div class="modalCart__info">\n                <p class="modalCart__name">Название: ${t}</p>\n                <div class="modalCart__count"><span class="modalCart__span">Количество: ${r}</span></div>\n                <div>Цена: <span class="modalCart__price">${o}</span>₴</div>\n            </div>`}cartButton.addEventListener("click",()=>{if(!0!==cartActive)return alert("Зарегистрируйтесь, что бы иметь доступ к своей личной корзине."),cartButton.style.cursor="pointer",cartButton.removeAttribute("data-fancybox","modalCart"),cartButton.removeAttribute("data-src","#modalCart"),void cartButton.removeAttribute("href","javascript:;");cartButton.setAttribute("data-fancybox","modalCart"),cartButton.setAttribute("data-src","#modalCart"),cartButton.setAttribute("href","javascript:;")});let cartSpan=document.querySelector("#cartCount"),cartCount=+cart.innerText;!function(){cartItems.forEach(e=>{let t=document.createElement("div");t.classList.add("modalCart__item"),t.dataset.id=e.orderId,t.dataset.price=e.orderPrice,t.dataset.amount=e.orderAmount,cartCount=cartItems.length,cartSpan.innerText=cartCount,t.innerHTML=createCartItem(returnBook(e.orderId).imageUrl,returnBook(e.orderId).name,e.orderPrice,e.orderAmount),cartItemsBlock.append(t)});let e=document.querySelector("#finalPrice"),t=document.querySelectorAll(".modalCart__price"),o=0,r=document.querySelector(".modalCart__buy"),n=document.querySelector(".modalCart__buyBlock");0===cartItems.length&&(n.style.display="none");let a=t=>{e.textContent=`${t}₴`};function i(){$(this).closest($(".modalCart__item")).remove(),function(e){let t=0;e.forEach(e=>t+=parseInt(e.textContent)),a(t)}(t=document.querySelectorAll(".modalCart__price")),function(e){let t;cartItems=[],e.each(function(){t={orderId:+$(this).attr("data-id"),orderPrice:+$(this).attr("data-price"),orderAmount:+$(this).attr("data-amount")},cartItems.push(t)}),localStorage.setItem("WildBook's cart",JSON.stringify(cartItems))}($(".modalCart__item")),cartCount=cartItems.length,cartSpan.innerText=cartCount,0===cartItems.length&&(n.style.display="none")}t.forEach(e=>o+=parseInt(e.textContent)),a(o),$(".modalCart__delete").each(function(){$(this).on("click",i)}),r.addEventListener("click",()=>{!function(){let e=document.querySelector(".modalCart__email");""===e.value||" "===e.value?r.removeAttribute("type"):(cartItems=[],localStorage.setItem("WildBook's cart",JSON.stringify(cartItems)),r.setAttribute("type","submit"))}()})}();