"use strict";null!=localStorage.getItem("WildBook's books")&&null!=localStorage.getItem("WildBook's cart")&&null!=localStorage.getItem("WildBook's profiles")||(localStorage.setItem("WildBook's books",JSON.stringify(booksData)),localStorage.setItem("WildBook's cart",JSON.stringify(cartData)),localStorage.setItem("WildBook's profiles",JSON.stringify(profilesData)));let $buttonUp=$(".buttonUp");function parseJSON(){return JSON.parse(localStorage.getItem("WildBook's books"))}function parseProfilesData(){return JSON.parse(localStorage.getItem("WildBook's profiles"))}function parseCartData(){return JSON.parse(localStorage.getItem("WildBook's cart"))}$buttonUp.hide(),$buttonUp.on("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),function e(){window.addEventListener("scroll",e),$(document).scrollTop()>$(window).height()?$buttonUp.fadeIn(400):$buttonUp.fadeOut(400)}(),$(function(){$("html").animate({scrollTop:$("#support").offset().top},650)});let isActive,cartActive,buttonEntrance=document.querySelector(".modalEntrance__button"),buttonBlock=document.querySelector(".menu__item_profileBlock"),buttonMessage=document.querySelector("#uniqueButton"),cart=document.querySelector("#cart"),cartItems=parseCartData(),cartButton=document.querySelector("#cartButton"),profilePhoto=document.querySelector(".modalProfile__photo"),profileEmail=document.querySelector("#profileEmail"),profileLogin=document.querySelector("#profileLogin"),profilePassword=document.querySelector("#profilePassword"),profiles=parseProfilesData();function profileEntrance(){let e=document.querySelector("#accountLogin"),t=document.querySelector("#accountPassword"),o=document.querySelector('[data-fancybox="modalAccount"]'),r=e.value,a=t.value;profiles.forEach(e=>{if(r===e.login&&a===e.password){$.fancybox.close(),isActive=!0,cartActive=!0,e.active=!0,o.remove(),localStorage.setItem("WildBook's profiles",JSON.stringify(profiles));let t=document.createElement("a");t.classList.add("menu__link","menu__link_style"),t.innerText=e.login,t.setAttribute("data-fancybox","modalProfile"),t.setAttribute("data-src","#modalProfile"),t.style.cursor="pointer",buttonBlock.prepend(t),profilePhoto.setAttribute("src",`${e.photo}`),profileEmail.value=e.email,profileLogin.value=e.login,profilePassword.value=e.password,checkUniqueButton(),checkCart()}})}buttonEntrance.addEventListener("click",function(e){e.preventDefault(),profileEntrance()});let photoChanged,profileIndex,buttonProfileEdit=document.querySelector(".modalProfile__edit");buttonProfileEdit.addEventListener("click",function(e){e.preventDefault();let t,o={email:profileEmail.value,login:profileLogin.value,password:profilePassword.value,photo:profilePhoto.src,active:!0};profiles.forEach(e=>{if(profileIndex=profiles.indexOf(e),(o.email!==e.email||o.login!==e.login||o.password!==e.password||!0===photoChanged)&&!0===(t=confirm("Применить внесенные изменения?")))if(photoChanged=!1,!0===e.admin){let e={email:profileEmail.value,login:profileLogin.value,password:profilePassword.value,photo:profilePhoto.src,admin:!0,active:!0};profiles[profileIndex]=e,localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))}else profiles[profileIndex]=o,localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))})});let buttonExit=document.querySelector(".modalProfile__exit");function checkUniqueButton(){!0===isActive?(buttonMessage.classList.remove("section2__button_style"),buttonMessage.removeAttribute("disabled")):(buttonMessage.classList.add("section2__button_style"),buttonMessage.setAttribute("disabled","disabled"))}function changeProfileButton(){let e=document.querySelector(".menu__link_style"),t=document.createElement("a");$.fancybox.close(),e.remove(),t.classList.add("menu__link","menu__link_style"),t.innerText="Личный кабинет",t.setAttribute("data-fancybox","modalAccount"),t.setAttribute("data-src","#modalAccount"),t.style.cursor="pointer",buttonBlock.prepend(t)}buttonExit.addEventListener("click",function(e){e.preventDefault(),!0===confirm("Вы уверены, что хотите выйти?")&&(cartActive=!1,isActive=!1,profiles.forEach(e=>{e.active=!1}),localStorage.setItem("WildBook's profiles",JSON.stringify(profiles)),changeProfileButton(),checkUniqueButton(),checkCart())});let email=document.querySelector("#regEmail"),login=document.querySelector("#regLogin"),password=document.querySelector("#regPassword"),photo=document.querySelector(".modalReg__photo"),inputPhoto=document.querySelector(".modalReg__setPhoto");function profileRegistration(){let e=document.querySelector(".modalReg__button");e.addEventListener("click",()=>{if(""===email.value||""===login.value||""===password.value)e.removeAttribute("data-fancybox");else{e.setAttribute("data-fancybox","modalSuccessfulReg");let t={email:email.value,login:login.value,password:password.value,photo:photo.src};profiles.push(t),localStorage.setItem("WildBook's profiles",JSON.stringify(profiles))}})}function chooseFileProfile(e){let t=e.target,o=new FileReader;o.onload=function(){let e=o.result;document.querySelector(".modalProfile__photo").src=e},o.readAsDataURL(t.files[0]),photoChanged=!0}function chooseFile(e){let t=e.target,o=new FileReader;o.onload=function(){let e=o.result;document.querySelector(".modalReg__photo").src=e},o.readAsDataURL(t.files[0])}profileRegistration();let buttonRegExit=document.querySelector(".modalSuccessReg__button");function checkCart(){!0===cartActive?cart.classList.remove("menu__icon_style"):cart.classList.add("menu__icon_style")}function returnBook(e){let t;return parseJSON().forEach(o=>{+e==+o.id&&(t=o)}),t}buttonRegExit.addEventListener("click",()=>{document.querySelectorAll(".modal").forEach(e=>{$.fancybox.close()}),email.value="",login.value="",password.value="",photo.src="./img/ProfilesPhotos/no-photo.jpg"}),$(document).ready(function(){let e=document.querySelector(".menu__link_style");profiles.forEach(t=>{if(t.active){isActive=!0,cartActive=!0,$.fancybox.close(),e.remove();let o=document.createElement("a");o.classList.add("menu__link","menu__link_style"),o.innerText=t.login,o.setAttribute("data-fancybox","modalProfile"),o.setAttribute("data-src","#modalProfile"),o.style.cursor="pointer",buttonBlock.prepend(o),profilePhoto.setAttribute("src",`${t.photo}`),profileEmail.value=t.email,profileLogin.value=t.login,profilePassword.value=t.password,checkUniqueButton(),checkCart()}})});let modalCart=document.querySelector("#modalCart"),cartImage=document.querySelector(".modalCart__image"),cartItemsBlock=document.querySelector(".modalCart__items");function createCartItem(e,t,o,r){return`<div class="modalCart__remove">\n                <i class="far fa-trash-alt modalCart__delete"></i>\n            </div>\n            <img src="${e}" alt="${t}" class="modalCart__image">\n            <div class="modalCart__info">\n                <p class="modalCart__name">Название: ${t}</p>\n                <div class="modalCart__count"><span class="modalCart__span">Количество: ${r}</span></div>\n                <div>Цена: <span class="modalCart__price">${o}</span>₴</div>\n            </div>`}cartButton.addEventListener("click",()=>{if(!0!==cartActive)return alert("Зарегистрируйтесь, что бы иметь доступ к своей личной корзине."),cartButton.style.cursor="pointer",cartButton.removeAttribute("data-fancybox","modalCart"),cartButton.removeAttribute("data-src","#modalCart"),void cartButton.removeAttribute("href","javascript:;");cartButton.setAttribute("data-fancybox","modalCart"),cartButton.setAttribute("data-src","#modalCart"),cartButton.setAttribute("href","javascript:;")});let cartSpan=document.querySelector("#cartCount"),cartCount=+cart.innerText;!function(){cartItems.forEach(e=>{let t=document.createElement("div");t.classList.add("modalCart__item"),t.dataset.id=e.orderId,t.dataset.price=e.orderPrice,t.dataset.amount=e.orderAmount,cartCount=cartItems.length,cartSpan.innerText=cartCount,t.innerHTML=createCartItem(returnBook(e.orderId).imageUrl,returnBook(e.orderId).name,e.orderPrice,e.orderAmount),cartItemsBlock.append(t)});let e=document.querySelector("#finalPrice"),t=document.querySelectorAll(".modalCart__price"),o=0,r=document.querySelector(".modalCart__buy"),a=document.querySelector(".modalCart__buyBlock");0===cartItems.length&&(a.style.display="none");let l=t=>{e.textContent=`${t}₴`};function n(){$(this).closest($(".modalCart__item")).remove(),function(e){let t=0;e.forEach(e=>t+=parseInt(e.textContent)),l(t)}(t=document.querySelectorAll(".modalCart__price")),function(e){let t;cartItems=[],e.each(function(){t={orderId:+$(this).attr("data-id"),orderPrice:+$(this).attr("data-price"),orderAmount:+$(this).attr("data-amount")},cartItems.push(t)}),localStorage.setItem("WildBook's cart",JSON.stringify(cartItems))}($(".modalCart__item")),cartCount=cartItems.length,cartSpan.innerText=cartCount,0===cartItems.length&&(a.style.display="none")}t.forEach(e=>o+=parseInt(e.textContent)),l(o),$(".modalCart__delete").each(function(){$(this).on("click",n)}),r.addEventListener("click",()=>{!function(){let e=document.querySelector(".modalCart__email");""===e.value||" "===e.value?r.removeAttribute("type"):(cartItems=[],localStorage.setItem("WildBook's cart",JSON.stringify(cartItems)),r.setAttribute("type","submit"))}()})}(),$(function(){$(".section2__tabs").on("click","li:not(.section2__tab_active)",function(){$(this).addClass("section2__tab_active").siblings().removeClass("section2__tab_active").closest(".container").find(".section2__main").removeClass("section2__main_active").eq($(this).index()).addClass("section2__main_active")})});